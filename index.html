<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Oil Wells Dashboard with AI Chatbot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .dashboard-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem 0; }
        .map-container { height: 500px; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .stats-card { background: white; border-radius: 10px; padding: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 1rem; }
        .nav-pills .nav-link.active { background-color: #667eea; }
        .nav-pills .nav-link { color: #667eea; }
        
        /* Chatbot Styles */
        .chatbot-container { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            width: 350px; 
            height: 500px; 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            z-index: 1000;
            display: none;
        }
        .chatbot-header { 
            background: linear-gradient(135deg, #2E86AB 0%, #A23B72 100%); 
            color: white; 
            padding: 15px; 
            border-radius: 15px 15px 0 0; 
            cursor: pointer;
        }
        .chatbot-messages { 
            height: 350px; 
            overflow-y: auto; 
            padding: 15px; 
            background: #f8f9fa;
        }
        .chatbot-input { 
            padding: 15px; 
            border-top: 1px solid #e9ecef; 
            background: white; 
            border-radius: 0 0 15px 15px;
        }
        .message { margin-bottom: 10px; }
        .user-message { text-align: right; }
        .bot-message { text-align: left; }
        .message-bubble { 
            display: inline-block; 
            padding: 10px 15px; 
            border-radius: 18px; 
            max-width: 80%; 
            word-wrap: break-word;
        }
        .user-bubble { background: #007bff; color: white; }
        .bot-bubble { background: white; border: 1px solid #e9ecef; }
        .chatbot-toggle { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            width: 60px; 
            height: 60px; 
            background: linear-gradient(135deg, #2E86AB 0%, #A23B72 100%); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-size: 24px; 
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1001;
        }
        .typing-indicator { 
            display: none; 
            color: #6c757d; 
            font-style: italic; 
            padding: 10px;
        }
        .suggestion-chip { 
            display: inline-block; 
            margin: 3px; 
            padding: 5px 10px; 
            background: #e9ecef; 
            border-radius: 15px; 
            cursor: pointer; 
            font-size: 12px;
            transition: all 0.3s;
        }
        .suggestion-chip:hover { background: #007bff; color: white; }
    </style>
</head>
<body>
    <div class="dashboard-header text-center">
        <div class="container">
            <h1><i class="fas fa-oil-can"></i> Indian Oil Wells Interactive Dashboard</h1>
            <p class="lead">Comprehensive visualization with AI Chatbot Assistant</p>
            <p><strong>Data Source:</strong> Ministry of Petroleum and Natural Gas (as of April 1, 2021)</p>
        </div>
    </div>
    
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-3">
                <div class="stats-card">
                    <h5><i class="fas fa-chart-bar text-primary"></i> Key Statistics</h5>
                    <hr>
                    <p><strong>Total Wells:</strong> <span id="totalWells">7,490</span></p>
                    <p><strong>Oil Wells:</strong> <span id="oilWells">6,092</span></p>
                    <p><strong>Gas Wells:</strong> <span id="gasWells">1,398</span></p>
                    <p><strong>Offshore:</strong> <span id="offshoreWells">1,496</span> (20%)</p>
                    <p><strong>Onshore:</strong> <span id="onshoreWells">5,994</span> (80%)</p>
                </div>
                
                <div class="stats-card">
                    <h5><i class="fas fa-trophy text-warning"></i> Top States</h5>
                    <hr>
                    <div id="topStates">
                        <p><strong>1. Gujarat:</strong> 3,547 wells</p>
                        <p><strong>2. Assam & Arunachal:</strong> 903 wells</p>
                        <p><strong>3. Rajasthan:</strong> 459 wells</p>
                        <p><strong>4. West Bengal:</strong> 362 wells</p>
                        <p><strong>5. Madhya Pradesh:</strong> 294 wells</p>
                    </div>
                </div>
                
                <div class="stats-card">
                    <h5><i class="fas fa-building text-info"></i> Major Companies</h5>
                    <hr>
                    <div id="companies">
                        <p><strong>ONGC:</strong> 7,315 wells</p>
                        <p><strong>Oil India:</strong> 455 wells</p>
                        <p><strong>PSC/RSC Regime:</strong> 1,344 wells</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="main-tab" data-bs-toggle="pill" data-bs-target="#main" type="button">
                            <i class="fas fa-map"></i> Main Map
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="offshore-tab" data-bs-toggle="pill" data-bs-target="#offshore" type="button">
                            <i class="fas fa-anchor"></i> Offshore Wells
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="company-tab" data-bs-toggle="pill" data-bs-target="#company" type="button">
                            <i class="fas fa-building"></i> Companies
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="pills-tabContent">
                    <div class="tab-pane fade show active" id="main" role="tabpanel">
                        <div class="map-container">
                            <iframe src="main_oil_map.html" width="100%" height="100%" frameborder="0"></iframe>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="offshore" role="tabpanel">
                        <div class="map-container">
                            <iframe src="offshore_oil_map.html" width="100%" height="100%" frameborder="0"></iframe>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="company" role="tabpanel">
                        <div class="map-container">
                            <iframe src="company_oil_map.html" width="100%" height="100%" frameborder="0"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Chatbot Toggle Button -->
    <div class="chatbot-toggle" onclick="toggleChatbot()">
        <i class="fas fa-robot"></i>
    </div>
    
    <!-- Chatbot Container -->
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header" onclick="toggleChatbot()">
            <h5 class="mb-0"><i class="fas fa-robot"></i> Oil Wells AI Assistant</h5>
            <small>Click to minimize</small>
        </div>
        
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="message bot-message">
                <div class="message-bubble bot-bubble">
                    <strong>ü§ñ AI Assistant:</strong> Hello! I'm your AI assistant for Indian oil wells data. 
                    I can answer questions about wells, states, companies, and more. What would you like to know?
                </div>
            </div>
            
            <div class="suggestion-chip" onclick="askQuestion('How many total wells are there in India?')">
                Total wells in India
            </div>
            <div class="suggestion-chip" onclick="askQuestion('How many wells are in Gujarat?')">
                Gujarat wells
            </div>
            <div class="suggestion-chip" onclick="askQuestion('Which state has the most wells?')">
                Top state
            </div>
            <div class="suggestion-chip" onclick="askQuestion('How many offshore wells are there?')">
                Offshore wells
            </div>
            <div class="suggestion-chip" onclick="askQuestion('Which companies operate wells?')">
                Companies
            </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <i class="fas fa-circle"></i> AI is thinking...
        </div>
        
        <div class="chatbot-input">
            <div class="input-group">
                <input type="text" class="form-control" id="messageInput" placeholder="Ask about oil wells..." onkeypress="handleKeyPress(event)">
                <button class="btn btn-primary" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Oil Wells Data Cache
        let oilWellsData = null;
        let isChatbotOpen = false;
        
        // Initialize chatbot
        document.addEventListener('DOMContentLoaded', function() {
            loadOilWellsData();
        });
        
        // Load oil wells data from API
        async function loadOilWellsData() {
            try {
                const response = await fetch('/.netlify/functions/api-proxy?format=json&limit=1000');
                const data = await response.json();
                
                if (data && data.records) {
                    oilWellsData = data;
                    updateDashboard(data);
                }
            } catch (error) {
                console.error('Error loading data:', error);
                addBotMessage('Sorry, I had trouble loading the latest data. Using cached information.');
            }
        }
        
        // Update dashboard with fresh data
        function updateDashboard(data) {
            const records = data.records || [];
            let stateData = {};
            
            // Find total flowing wells record
            for (let record of records) {
                if (record.status && record.status.includes('Total Flowing Wells')) {
                    stateData = record;
                    break;
                }
            }
            
            if (stateData._total) {
                document.getElementById('totalWells').textContent = stateData._total.toLocaleString();
                
                const offshore = parseFloat(stateData.offshore) || 0;
                const onshore = stateData._total - offshore;
                
                document.getElementById('offshoreWells').textContent = offshore.toLocaleString();
                document.getElementById('onshoreWells').textContent = onshore.toLocaleString();
            }
        }
        
        // Chatbot Functions
        function toggleChatbot() {
            const container = document.getElementById('chatbotContainer');
            isChatbotOpen = !isChatbotOpen;
            container.style.display = isChatbotOpen ? 'block' : 'none';
            
            if (isChatbotOpen) {
                document.getElementById('messageInput').focus();
            }
        }
        
        function addMessage(message, isUser = false) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = `message-bubble ${isUser ? 'user-bubble' : 'bot-bubble'}`;
            
            if (isUser) {
                bubbleDiv.innerHTML = `<strong>üë§ You:</strong> ${message}`;
            } else {
                bubbleDiv.innerHTML = `<strong>ü§ñ AI:</strong> ${message.replace(/\n/g, '<br>')}`;
            }
            
            messageDiv.appendChild(bubbleDiv);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function addBotMessage(message) {
            addMessage(message, false);
        }
        
        function showTyping() {
            document.getElementById('typingIndicator').style.display = 'block';
        }
        
        function hideTyping() {
            document.getElementById('typingIndicator').style.display = 'none';
        }
        
        function askQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                addMessage(message, true);
                input.value = '';
                
                showTyping();
                
                // Simulate AI thinking time
                setTimeout(() => {
                    hideTyping();
                    const response = generateAIResponse(message);
                    addMessage(response);
                }, 1000 + Math.random() * 1000);
            }
        }
        
        // AI Response Generation
        function generateAIResponse(query) {
            if (!oilWellsData) {
                return "I'm having trouble accessing the data right now. Please try again in a moment.";
            }
            
            const queryLower = query.toLowerCase();
            const records = oilWellsData.records || [];
            let stateData = {};
            
            // Find total flowing wells record
            for (let record of records) {
                if (record.status && record.status.includes('Total Flowing Wells')) {
                    stateData = record;
                    break;
                }
            }
            
            // Intent detection and response generation
            if (queryLower.includes('total') && (queryLower.includes('well') || queryLower.includes('count'))) {
                const total = stateData._total || 0;
                const offshore = parseFloat(stateData.offshore) || 0;
                const onshore = total - offshore;
                const offshorePercent = total > 0 ? (offshore / total * 100).toFixed(1) : 0;
                const onshorePercent = total > 0 ? (onshore / total * 100).toFixed(1) : 0;
                
                return `üìä **Total Oil Wells in India: ${total.toLocaleString()}**

üåä **Offshore Wells:** ${offshore.toLocaleString()} (${offshorePercent}%)
üèîÔ∏è **Onshore Wells:** ${onshore.toLocaleString()} (${onshorePercent}%)

*Data as of April 1, 2021*`;
            }
            
            if (queryLower.includes('gujarat')) {
                const wells = parseFloat(stateData.gujarat) || 0;
                const total = stateData._total || 0;
                const percentage = total > 0 ? (wells / total * 100).toFixed(1) : 0;
                
                return `üèõÔ∏è **Gujarat:** ${wells.toLocaleString()} wells (${percentage}% of total)

Gujarat is the leading state with the highest number of oil wells in India. The state hosts major oil fields and refineries operated by ONGC and other companies.`;
            }
            
            if (queryLower.includes('rajasthan')) {
                const wells = parseFloat(stateData.rajasthan) || 0;
                const total = stateData._total || 0;
                const percentage = total > 0 ? (wells / total * 100).toFixed(1) : 0;
                
                return `üèõÔ∏è **Rajasthan:** ${wells.toLocaleString()} wells (${percentage}% of total)

Rajasthan is home to significant oil fields, particularly operated by Cairn Oil & Gas (Vedanta) in the Barmer region.`;
            }
            
            if (queryLower.includes('assam')) {
                const wells = parseFloat(stateData.assam___arunachal_pradesh) || 0;
                const total = stateData._total || 0;
                const percentage = total > 0 ? (wells / total * 100).toFixed(1) : 0;
                
                return `üèõÔ∏è **Assam & Arunachal Pradesh:** ${wells.toLocaleString()} wells (${percentage}% of total)

Assam is one of India's oldest oil-producing regions, with operations by ONGC and Oil India Limited.`;
            }
            
            if (queryLower.includes('offshore')) {
                const offshore = parseFloat(stateData.offshore) || 0;
                const total = stateData._total || 0;
                const percentage = total > 0 ? (offshore / total * 100).toFixed(1) : 0;
                
                return `üåä **Offshore Wells:** ${offshore.toLocaleString()} wells (${percentage}% of total)

Major offshore fields include Mumbai High, KG-D6, and Cauvery Basin. These are operated primarily by ONGC and Reliance Industries.`;
            }
            
            if (queryLower.includes('onshore')) {
                const offshore = parseFloat(stateData.offshore) || 0;
                const total = stateData._total || 0;
                const onshore = total - offshore;
                const percentage = total > 0 ? (onshore / total * 100).toFixed(1) : 0;
                
                return `üèîÔ∏è **Onshore Wells:** ${onshore.toLocaleString()} wells (${percentage}% of total)

Most wells are located onshore across various states, with Gujarat leading in onshore production.`;
            }
            
            if (queryLower.includes('company') || queryLower.includes('companies')) {
                let ongcWells = 0;
                let oilIndiaWells = 0;
                let pscWells = 0;
                
                for (let record of records) {
                    const status = record.status || '';
                    const total = parseFloat(record._total) || 0;
                    
                    if (status.includes('ONGC (Nomination)')) {
                        ongcWells += total;
                    } else if (status.includes('Oil (Nomination)')) {
                        oilIndiaWells += total;
                    } else if (status.includes('PSC/RSC & CBM Regime')) {
                        pscWells += total;
                    }
                }
                
                return `üè¢ **Major Companies Operating Wells:**

‚Ä¢ **ONGC (Oil and Natural Gas Corporation):** ${ongcWells.toLocaleString()} wells
‚Ä¢ **Oil India Limited:** ${oilIndiaWells.toLocaleString()} wells  
‚Ä¢ **PSC/RSC Companies:** ${pscWells.toLocaleString()} wells

ONGC is the largest operator, followed by Oil India Limited and various private companies under PSC contracts.`;
            }
            
            if (queryLower.includes('rank') || queryLower.includes('top') || queryLower.includes('most')) {
                const states = [
                    {name: 'Gujarat', wells: parseFloat(stateData.gujarat) || 0},
                    {name: 'Assam & Arunachal Pradesh', wells: parseFloat(stateData.assam___arunachal_pradesh) || 0},
                    {name: 'Rajasthan', wells: parseFloat(stateData.rajasthan) || 0},
                    {name: 'West Bengal (CBM)', wells: parseFloat(stateData.west_bangal__cbm_) || 0},
                    {name: 'Madhya Pradesh (CBM)', wells: parseFloat(stateData.madhya_pradesh__cbm_) || 0},
                    {name: 'Tamil Nadu', wells: parseFloat(stateData.tamilnadu) || 0},
                    {name: 'Andhra Pradesh', wells: parseFloat(stateData.andhra_pradesh) || 0},
                    {name: 'Tripura', wells: parseFloat(stateData.tripura) || 0},
                    {name: 'Jharkhand (CBM)', wells: parseFloat(stateData.jharkhand__cbm_) || 0}
                ];
                
                states.sort((a, b) => b.wells - a.wells);
                
                let response = "üìà **State Rankings by Well Count:**\n\n";
                for (let i = 0; i < Math.min(5, states.length); i++) {
                    if (states[i].wells > 0) {
                        response += `${i + 1}. **${states[i].name}:** ${states[i].wells.toLocaleString()} wells\n`;
                    }
                }
                
                return response;
            }
            
            if (queryLower.includes('help')) {
                return `ü§ñ **Oil Wells AI Assistant Help**

I can help you with information about oil wells in India! Here are some things you can ask:

üìä **General Questions:**
‚Ä¢ "How many total wells are there in India?"
‚Ä¢ "What's the breakdown of offshore vs onshore wells?"

üèõÔ∏è **State-specific Questions:**
‚Ä¢ "How many wells are in Gujarat?"
‚Ä¢ "What's the percentage of wells in Rajasthan?"
‚Ä¢ "Show me Assam wells data"

üè¢ **Company Questions:**
‚Ä¢ "Which companies operate wells?"
‚Ä¢ "How many wells does ONGC have?"

üìà **Rankings & Comparisons:**
‚Ä¢ "Which state has the most wells?"
‚Ä¢ "Rank states by well count"

üåä **Offshore/Onshore:**
‚Ä¢ "How many offshore wells are there?"
‚Ä¢ "What percentage are onshore?"

Just ask me anything about Indian oil wells! üõ¢Ô∏è`;
            }
            
            // Default response
            return `I understand you're asking about "${query}". I can help you with information about:

‚Ä¢ Total wells in India
‚Ä¢ State-wise well distribution  
‚Ä¢ Company operations
‚Ä¢ Offshore vs onshore wells
‚Ä¢ Rankings and comparisons

Try asking something like "How many wells are in Gujarat?" or "Which state has the most wells?"`;
        }
    </script>
</body>
</html>
